var ts_last_js_running=new Date,ts_last_internet_ping=new Date,remoteAssetToCheckForInHealthCheck="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js",globalShouldPerformGlobalAppHealthCheck=!0;
function _7054ff955a935db0062fd53f0652adb929ad0704(a,b){if(!globalShouldPerformGlobalAppHealthCheck)return!1;_439fc287471807456f79b1fd2d9ee4f7a7e1e6fc("Inside of _7054ff955a935db0062fd53f0652adb929ad0704.  Checking user internet connectivity.","green","14px");navigator.onLine?(_40eb8db60d95ab4a6b04717ce6ff873be8afcd4e({name:"internet-connection-check-before-ajax-network-OK"}),$.ajax({type:"GET",url:remoteAssetToCheckForInHealthCheck,timeout:5E3,cache:!1,dataType:"text",success:function(a){_2ffcff867d76eaad6c5607a20ef8bcdcca153655();
_439fc287471807456f79b1fd2d9ee4f7a7e1e6fc("internet connection check succeeded: "+remoteAssetToCheckForInHealthCheck,"green","14px");_40eb8db60d95ab4a6b04717ce6ff873be8afcd4e({name:"internet-connection-check-SUCCESS"});b&&"navigator-online"==b&&(_439fc287471807456f79b1fd2d9ee4f7a7e1e6fc("_7054ff955a935db0062fd53f0652adb929ad0704 triggered from navigator.onLine.  Current ts: "+new Date,"green","14px"),___getPhoneStatus(),_58dac90a4c4c9cebacc0063208d839303fd84e73({get_latest_notifs_for_existing:!0}),
"CRX"!=clientRunningScript?_a8d698d5df146c6fb540e8c3128f265919412719(0):void 0!=socket&&(_439fc287471807456f79b1fd2d9ee4f7a7e1e6fc("_7054ff955a935db0062fd53f0652adb929ad0704 triggered from navigator.onLine.  User is on CRX and previously established a CAPI socket. Checking CAPI Socket health now.","green","14px"),_a8d698d5df146c6fb540e8c3128f265919412719(0)));"CRX"!=clientRunningScript?(_6e3ec1c08e2a70592e44a1ad1c86d8cd6baa8e54(),_370e12b89bfefdd2fe41cce5caa6d6f2b69ec3cc()):void 0===socket?(_439fc287471807456f79b1fd2d9ee4f7a7e1e6fc("User is on CRX and have never previously established a CAPI socket. Restarting the CRX.",
"green","14px"),setTimeout(function(){_75a3f6791f531f3f04a44f2332e1760564962648("App-Health-Never-Had-CAPI-Socket")},500)):(_439fc287471807456f79b1fd2d9ee4f7a7e1e6fc("User is on CRX and have previously established a CAPI socket. Making sure browser action icon is set to teal and that they have context menus.","green","14px"),_7f994d2d698f4d48e48b760f7dc4815663234040("user-logged-in"),_ba256ebb91e7ecec954d6c672bb1ed9401020207())},error:function(){_370e12b89bfefdd2fe41cce5caa6d6f2b69ec3cc();_40eb8db60d95ab4a6b04717ce6ff873be8afcd4e({name:"internet-connection-check-ERROR"});
a&&a()}})):(a&&a(),_370e12b89bfefdd2fe41cce5caa6d6f2b69ec3cc())}
function _4e4fd9668acd6926940c51a96e9b7036f8066dcb(){if(!globalShouldPerformGlobalAppHealthCheck)return!1;_439fc287471807456f79b1fd2d9ee4f7a7e1e6fc("Setting listeners for user network events and global ajax methods.","blue","14px");window.addEventListener("online",function(){_439fc287471807456f79b1fd2d9ee4f7a7e1e6fc("User gained network connection.","blue","14px");setTimeout(function(){_7054ff955a935db0062fd53f0652adb929ad0704(!1,"navigator-online");_40eb8db60d95ab4a6b04717ce6ff873be8afcd4e({name:"navigator-online-listener-triggered"})},
5E3)});window.addEventListener("offline",function(){_439fc287471807456f79b1fd2d9ee4f7a7e1e6fc("User lost network connection.","blue","14px");_7054ff955a935db0062fd53f0652adb929ad0704(_680eaad67bd6c1b5d47fbafd89830927a40a3b62)});$(document).ajaxSend(function(a,b){!1===navigator.onLine&&_680eaad67bd6c1b5d47fbafd89830927a40a3b62()});$(document).ajaxSuccess(function(a,b){_2ffcff867d76eaad6c5607a20ef8bcdcca153655()})}
function _afe0f75e8fbafa73021339d1b47d122e6027cad0(){if(!globalShouldPerformGlobalAppHealthCheck)return!1;var a=ts_last_js_running;ts_last_js_running=new Date;_439fc287471807456f79b1fd2d9ee4f7a7e1e6fc("Inside of _afe0f75e8fbafa73021339d1b47d122e6027cad0.  Checking user internet connectivity last confirmed ("+_cadee3632141e4f55883f123feaad8345cb49919(ts_last_internet_ping)+" seconds ago) and js staleness ("+_cadee3632141e4f55883f123feaad8345cb49919(a)+" seconds ago) (non CRX only)","purple","14px");
180<_cadee3632141e4f55883f123feaad8345cb49919(ts_last_internet_ping)&&(_439fc287471807456f79b1fd2d9ee4f7a7e1e6fc("It has been too long since ts_last_internet_ping was updated. Checking user internet connection","purple","14px"),_7054ff955a935db0062fd53f0652adb929ad0704(_680eaad67bd6c1b5d47fbafd89830927a40a3b62),_40eb8db60d95ab4a6b04717ce6ff873be8afcd4e({name:"internet-connection-stale",label:_cadee3632141e4f55883f123feaad8345cb49919(ts_last_internet_ping).toString()}));600<_cadee3632141e4f55883f123feaad8345cb49919(a)&&
"CRX"!=clientRunningScript&&(_40eb8db60d95ab4a6b04717ce6ff873be8afcd4e({name:"js-stale-detected"}),_439fc287471807456f79b1fd2d9ee4f7a7e1e6fc("User has stale JS","purple","14px"),_7054ff955a935db0062fd53f0652adb929ad0704(),setTimeout(function(){_2236aa67fe874640499881e37ba29124fd2ec2c2()},5500))}function _cadee3632141e4f55883f123feaad8345cb49919(a){return moment(new Date).diff(moment(a),"seconds")}
function _2ffcff867d76eaad6c5607a20ef8bcdcca153655(){if(!globalShouldPerformGlobalAppHealthCheck)return!1;_439fc287471807456f79b1fd2d9ee4f7a7e1e6fc("Updating ts_last_internet_ping to: "+new Date,"blue","14px");ts_last_internet_ping=new Date}
function _2236aa67fe874640499881e37ba29124fd2ec2c2(){if(!globalShouldPerformGlobalAppHealthCheck)return!1;if("CLASSIC"==threadDisplayModeGlobal||"POWERVIEW"==threadDisplayModeGlobal){var a=getLanguageSpecificText("stale_app_warning_1",globalDefaultLanguage)+" "+getLanguageSpecificText("stale_app_warning_2",globalDefaultLanguage)+' <span id="stale-js-warning-reload" onclick="location.reload()" class="app-health-warning-action-span">'+getLanguageSpecificText("stale_app_warning_3",globalDefaultLanguage)+
"</span>";6>_cadee3632141e4f55883f123feaad8345cb49919(ts_last_internet_ping)&&navigator.onLine&&(a=getLanguageSpecificText("stale_app_warning_1",globalDefaultLanguage)+'<br><br><span id="stale-js-warning-reload" onclick="location.reload()" class="app-health-warning-action-span">'+getLanguageSpecificText("click_to_reload",globalDefaultLanguage)+"</span>");$.each($("#stale-js-warning-reload"),function(){$(this).parent().siblings(".customClose").click()});displayAlertMessage(a,"error",6E5)}}
function _680eaad67bd6c1b5d47fbafd89830927a40a3b62(){_439fc287471807456f79b1fd2d9ee4f7a7e1e6fc("Determined that the user has no internet connection.","red","14px");if("CRX"==clientRunningScript)_7f994d2d698f4d48e48b760f7dc4815663234040("no-internet");else{_6e3ec1c08e2a70592e44a1ad1c86d8cd6baa8e54();var a=$('<div id="internet-connectivity-warning" class="app-health-warning"><div class="app-health-warning-text">'+getLanguageSpecificText("offline",globalDefaultLanguage)+' <span id="check-network-connection-span-in-network-notif" class="app-health-warning-action-span"><i class="fa fa-fw fa-rotate-right"></i></span></div></div>').prependTo("body");
$(a).find("#check-network-connection-span-in-network-notif").click(function(){$(this).children(".fa").removeClass("fa-rotate-right").addClass("fa-circle-o-notch fa-spin");_7054ff955a935db0062fd53f0652adb929ad0704();_gaq.push(["_trackEvent","App-Checker","user-triggered-internet-request-from-offline-warning"])})}}
function _370e12b89bfefdd2fe41cce5caa6d6f2b69ec3cc(){setTimeout(function(){0<$("#check-network-connection-span-in-network-notif").length&&$("#check-network-connection-span-in-network-notif").children(".fa").removeClass("fa-circle-o-notch fa-spin").addClass("fa-rotate-right")},1500)}function _6e3ec1c08e2a70592e44a1ad1c86d8cd6baa8e54(){$.each($("#internet-connectivity-warning"),function(){$(this).remove()})}
function _651e16af715f5559f763edd3d750c170197a33b4(){if(!globalShouldPerformGlobalAppHealthCheck)return!1;_439fc287471807456f79b1fd2d9ee4f7a7e1e6fc("inside of _651e16af715f5559f763edd3d750c170197a33b4, calling _afe0f75e8fbafa73021339d1b47d122e6027cad0 every 30 seconds to determine user internet connectivity and stale js","purple","14px");setInterval(function(){_afe0f75e8fbafa73021339d1b47d122e6027cad0()},3E4)}
function _a8d698d5df146c6fb540e8c3128f265919412719(a){3>a?(_439fc287471807456f79b1fd2d9ee4f7a7e1e6fc("In _a8d698d5df146c6fb540e8c3128f265919412719 count: "+a,"#419ab1","14px"),_40eb8db60d95ab4a6b04717ce6ff873be8afcd4e({name:"check-capi-socket-triggered-attempt-"+a.toString()}),"CRX"!=clientRunningScript?sendCAPITestMessageFromWebApp("CAPI_HEALTH_CHECK_FROM_NEW_WEBAPP_2014"):_7245d443327f59a6033ba61f41db7e56f3676d55(),setTimeout(function(){_44fe7e29aaa42994a5ccfe238b2de199ec8ddc1b(a)},1E4)):(_439fc287471807456f79b1fd2d9ee4f7a7e1e6fc("No incoming CAPI's after 3 tries. Will reload CRX in 3 seconds",
"#419ab1","14px"),"CRX"!=clientRunningScript?(_40eb8db60d95ab4a6b04717ce6ff873be8afcd4e({name:"check-capi-socket-failed-3-times-reopen-socket"}),_439fc287471807456f79b1fd2d9ee4f7a7e1e6fc("In _a8d698d5df146c6fb540e8c3128f265919412719 count > = 3.  checking internet connection then close socket","#419ab1","14px"),_7054ff955a935db0062fd53f0652adb929ad0704Outbound(close_socket_then_channel_api_token_setup)):(_439fc287471807456f79b1fd2d9ee4f7a7e1e6fc("CAPI unstable. Will reload CRX in 3 seconds","#419ab1",
"14px"),_40eb8db60d95ab4a6b04717ce6ff873be8afcd4e({name:"check-capi-socket-failed-3-times-restart-CRX"}),setTimeout(function(){_75a3f6791f531f3f04a44f2332e1760564962648("App-Health-Failed-Reestablish-CAPI")},500)))}
function _44fe7e29aaa42994a5ccfe238b2de199ec8ddc1b(a){var b=((new Date).getTime()-global_time_last_CAPI_rcvd.getTime())/1E3;_439fc287471807456f79b1fd2d9ee4f7a7e1e6fc("Inside of _44fe7e29aaa42994a5ccfe238b2de199ec8ddc1b.  Last CAPI received: "+b+" seconds ago.","#419ab1","14px");30>b?(_40eb8db60d95ab4a6b04717ce6ff873be8afcd4e({name:"check-capi-socket-is-healthy"}),___getPhoneStatus(),_439fc287471807456f79b1fd2d9ee4f7a7e1e6fc("CAPI socket is good, don't reload CRX. Make sure that the Browser Action Icon accurately reflects that the crx is STABLE and request a new phone status update.",
"green","18px")):(_439fc287471807456f79b1fd2d9ee4f7a7e1e6fc("Inside of _44fe7e29aaa42994a5ccfe238b2de199ec8ddc1b.  FAILURE.","#419ab1","14px"),a++,_a8d698d5df146c6fb540e8c3128f265919412719(a))}function _439fc287471807456f79b1fd2d9ee4f7a7e1e6fc(a,b,c){console.log("%c"+a,"color: "+(b?b:"blue")+";font-size: "+(c?c:"large"))}
function _40eb8db60d95ab4a6b04717ce6ff873be8afcd4e(a){var b=10,c="-10pct-sample",d=a.name;"CRX"==clientRunningScript&&(b=100,c="-1pct-sample");c=["_trackEvent","App-Checker",d+c];a.hasOwnProperty("label")&&c.push(a.label);5==_ca0c0deea8fb4e9a92f70562c7c71a42822ce3c2(0,b)&&_gaq.push(c)};