console.log("+++++++++++++++++++++++++++++++++++ starting MightyText CRX +++++++++++++++++++++++++++++++++++\n\n");_7f994d2d698f4d48e48b760f7dc4815663234040("default-icon-on-background-start");
var baseUrl="https://textyserver.appspot.com",contactsFromPhoneGlobal=[],manifest=chrome.runtime.getManifest(),globalIntervalGetPhoneStatus,webapp_crx_globalUserSettingsUponCRXLoad,username_prefix_jstrg_purpose,google_username_currently_logged_in,isAProUser=!1,global_time_last_CAPI_rcvd=new Date,webapp_crx_time_last_channel_token_obtained=new Date,webapp_crx_time_last_successful_health_check_received=new Date,time_last_success_mighty_ping=new Date,notify_android_app_install_once=!1,globalPHONEContactsRefreshCacheQueue=
[],signInUrlCRX=baseUrl+"/signin?extret="+encodeURIComponent(chrome.extension.getURL("help.html"))+"%23signed_in&ver="+manifest.version,registerUrl=baseUrl+"/register?ver="+manifest.version,NEW_COUNT_GLOBAL_NOTIF=0,global_count_request_phone_status=0,deviceNotifManagerArray={},capi_helper_global_login_state="UNKNOWN",globalMsUntilShowNotLoggedInNotifAgain=36E5,globalLastKnownSystemStatus="UNKNOWN",globalSystemIdleStatusThresholdInSeconds=60,_gaq=_gaq||[];_gaq.push(["_setAccount","UA-21391541-14"]);
(function(){var a=document.createElement("script");a.type="text/javascript";a.async=!0;a.src="https://ssl.google-analytics.com/ga.js";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)})();var _kmq=_kmq||[],_kmk=_kmk||"a009d9e3633da7d7456e8e1478c8f05f33e35f8e";function _kms(a){setTimeout(function(){var b=document,c=b.getElementsByTagName("script")[0],b=b.createElement("script");b.type="text/javascript";b.async=!0;b.src=a;c.parentNode.insertBefore(b,c)},1)}_kms("https://i.kissmetrics.com/i.js");
_kms("https://scripts.kissmetrics.com/"+_kmk+".2.js");_kms("../scripts/km_secure.js");
(function(){var a=window,b=a.Intercom;if("function"===typeof b)b("reattach_activator"),b("update",intercomSettings);else{var b=function(){var a=c.createElement("script");a.type="text/javascript";a.async=!0;a.src="https://widget.intercom.io/widget/7guo5kws";var b=c.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)},c=document,d=function(){d.c(arguments)};d.q=[];d.c=function(a){d.q.push(a)};a.Intercom=d;a.attachEvent?a.attachEvent("onload",b):a.addEventListener("load",b,!1)}})();_1255cdf45e14e300b68bbf2484c0ff9732fa464d();
var globalHeartbeatInterval=setInterval(_f9b3ef677ab6deeaceee90c703a9d677f5ab111d,1E4),globalBrowserActionIconCheckerInterval=setInterval(function(){_ba46600e03bc97e6ebf07b304d91a5e7d4b109b9()},3E5),globalLockedNotificationCleanupInterval=setInterval(_6b949d6799f3b4ce228c7e5022ab6a379f3d16ef,6E4);17===_ca0c0deea8fb4e9a92f70562c7c71a42822ce3c2(0,100)&&_gaq.push(["_trackEvent","Background","Startup-BG-Script-1pct-Sample",manifest.version]);_4e4fd9668acd6926940c51a96e9b7036f8066dcb();
var flushedJstorageOnce=window.localStorage.crx_upgrade_jstorage_flushed;if(!flushedJstorageOnce)throw $.jStorage.flush(),window.localStorage.crx_upgrade_jstorage_flushed=1,setTimeout(function(){_75a3f6791f531f3f04a44f2332e1760564962648("Flushed-Jstorage")},1E3),console.log("javascript should stop executing now."),Error("Stopping JS to restart the CRX before any new jstorage values are set.");_eca843d89a93c24b6ff3bcbd1631607c4c198957(1,!0);$(document).ready(_b54a3300bcc2d8bf643802f90d142f2856ec3afc);
function _f9b3ef677ab6deeaceee90c703a9d677f5ab111d(){console.log("User is not logged in.  Checking when we last successfully made a request to textyserver.");checkLastMightyNetworkPing()}
function checkLastMightyNetworkPing(){var a=((new Date).getTime()-time_last_success_mighty_ping.getTime())/1E3;console.log("--------------\x3e Seconds Since LAST MightyText network ping: "+a);3600<a&&(_439fc287471807456f79b1fd2d9ee4f7a7e1e6fc("---\x3e has been a long time since last MT ping -- try to contact google.com first","red"),$.ajax({type:"GET",url:"https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js",dataType:"text",cache:!1,success:function(a){console.log("Network ping to Google -- fine...");
console.log("User is not logged in and there is an internet connection, but we have not received a response from texty server for over 60 minutes.  Will reload CRX BG in 10 seconds.");_75a3f6791f531f3f04a44f2332e1760564962648("Checking-Last-MightyNetwork-Ping")}}))}
function _24e15aa6972aa3ce175e29f72b02c21b5fee5b3d(){_9ee476716f1e4c3fb95fafbd6abccb4adf50e828();checkLastMightyNetworkPing();_314c73d59528148b8daf667b6d9444f224e8a7a0();console.log("-------------------------\x3e Heartbeat WEBAPP USER @ "+Date()+" ###")}
function _eca843d89a93c24b6ff3bcbd1631607c4c198957(a,b){a||(a=1);$.ajax({url:baseUrl+"/api?function=getUserInfoFull&CLIENT=CRX",type:"GET",timeout:5E3,dataType:"json",error:function(c,b,e){!navigator.onLine&&3>=a?(_7f994d2d698f4d48e48b760f7dc4815663234040("no-internet"),_651e16af715f5559f763edd3d750c170197a33b4()):(console.log("On retry attempt #"+a+" -- ERROR in AJAX in getUserInfoFull: "+e),3<a?_7ee8faf91222b20baef9f27cba869bdfc1b144db(_211d6cbf06e929bc9ed8388ee5588d8ba0dceda0,_651e16af715f5559f763edd3d750c170197a33b4):
window.setTimeout(function(){_eca843d89a93c24b6ff3bcbd1631607c4c198957(a+1)},2E3))},success:function(a,b,e){console.log(a);time_last_success_mighty_ping=new Date;a.user&&-1<a.user.indexOf("user not logged in")?(1>Math.floor(100*Math.random())&&_gaq.push(["_trackEvent","CRX-Background","Error","User-Not-Logged-In-CRX-1Pct-Sample",1]),_7090fdea2e3abbf2c7d2451d174f3d9835681edf(),_7f994d2d698f4d48e48b760f7dc4815663234040("user-not-logged-in")):a.user_info_full&&0<a.user_info_full.email.length?(999==a.user_info_full.premium?
isAProUser=!0:1==a.user_info_full.premium&&a.billing_info&&(billingInfo=a.billing_info,"active"==a.billing_info.status||"past_due"==a.billing_info.status||"trialing"==a.billing_info.status)&&(isAProUser=!0),google_username_currently_logged_in=a.user_info_full.email,e=a.user_info_full.ts_creation,b=new Date,_kmq.push(["identify",google_username_currently_logged_in]),_7ce66d304b3e35739b47dea2b0dab93c5a487c12(google_username_currently_logged_in,e,a,"CRX-MODERN-USER"),b=b.setHours(0,0,0,0),e=$.jStorage.get("ts_last_kissmetrics_login_call",
"no-km-last-login-set"),"no-km-last-login-set"==e&&_gaq.push(["_trackEvent","Background","CRX-KM-Last-TS",e]),e==b?6>Math.floor(10*Math.random())&&(_kmq.push(["record","User Logged In",{"CRX-Login":"true",Client:"CRX","Dup-Intraday":"true"}]),$.jStorage.set("ts_last_kissmetrics_login_call",b)):(_kmq.push(["record","User Logged In",{"CRX-Login":"true",Client:"CRX","Dup-Intraday":"false"}]),Intercom("trackEvent","User-Logged-In-CRX",{Client:"CRX","App-Version":manifest.version}),$.jStorage.set("ts_last_kissmetrics_login_call",
b)),void 0!=a.user_info_full.channelapi_enabled&&100==a.user_info_full.channelapi_enabled&&(username_prefix_jstrg_purpose=a.user_info_full.email.substr(0,a.user_info_full.email.indexOf("@")),_f7f927c5e0a27f1a405147b3474a75be10bd4b7f(a.user_info_full),10>_ca0c0deea8fb4e9a92f70562c7c71a42822ce3c2(0,100)&&_gaq.push(["_trackEvent","Background","CRX-User-Logged-In-10pct-Sample",manifest.version.toString()]),_d0bbc025a4845d2c64a018a23060445d61980f32())):(-1!=a.user_status.search("not registered")?(_c31efb070eaf3996b5a0f5805795819188f88aa1("NOT-REG"),
console.log("user has not registered a device w/ MT"),notify_android_app_install_once||(a={type:"basic",priority:2,title:chrome.i18n.getMessage("install_mt_notif_title"),message:chrome.i18n.getMessage("install_mt_notif_content").replace("%user_email%",a.email),contextMessage:chrome.i18n.getMessage("click_for_instructions")+".",iconUrl:"../img/48x48_MT_logo_boom_gradient_white.png"},chrome.notifications.create("user-install-android-app",a,function(a){console.log('just created a notif with the ID: "'+
a+'"')}),notify_android_app_install_once=!0)):(a={type:"basic",priority:2,title:"MightyText",message:chrome.i18n.getMessage("mt_gen_error_notif_content"),iconUrl:"../img/notifications/error_icon.png"},chrome.notifications.create("getuserinfofull-general-error",a,function(a){console.log('just created a notif with the ID: "'+a+'"');_a0b818d8a313f49406787ab60651b5d5970bed28(a);_501841532e653ca08fe8590565cf915540b3a799(a,3E4)})),_7f994d2d698f4d48e48b760f7dc4815663234040("user-not-logged-in"))}})}
function _c31efb070eaf3996b5a0f5805795819188f88aa1(a){2>Math.floor(80*Math.random())&&_kmq.push(["record","CRX-UserState-"+a])}
function _7ce66d304b3e35739b47dea2b0dab93c5a487c12(a,b,c,d){b=Math.round((new Date(b)).getTime()/1E3);var e=c.user_info_full.current_app_version,g=Math.round((new Date(c.user_info_full.ts_last_login)).getTime()/1E3),h=c.user_info_full.ts_first_login,f=Math.round((new Date(h)).getTime()/1E3);console.log(c);intercomSettings={email:a,created_at:b,app_id:"7guo5kws",web_app:d,phone_app_version:e,ts_last_login_at:g,wagda:"AUG-2016",app_version:manifest.version,pro_user:"NO","day-last-seen":_674dc0582783ca1191d27a031f3673318bc36ea9()};
void 0!=h&&(intercomSettings.ts_first_login_at=f);isAProUser&&(intercomSettings.pro_user="YES");c.billing_info&&(intercomSettings.plan_id=c.billing_info.plan_id);c.user_info_full.phone_lang&&(intercomSettings["phone-lang"]=c.user_info_full.phone_lang);window.Intercom("boot",intercomSettings)}
function _f7f927c5e0a27f1a405147b3474a75be10bd4b7f(a){setTimeout(function(){_2362347a367eb9b12584d58bc636ba8929137513(a)},5E3);_ba256ebb91e7ecec954d6c672bb1ed9401020207();_7f994d2d698f4d48e48b760f7dc4815663234040("user-logged-in");_a8ce297065d58be169132a83ee0abe3c86206ca1();_c31efb070eaf3996b5a0f5805795819188f88aa1("REG-OK");clearInterval(globalHeartbeatInterval);globalHeartbeatInterval=setInterval(_24e15aa6972aa3ce175e29f72b02c21b5fee5b3d,2E4);___getPhoneStatus();_58dac90a4c4c9cebacc0063208d839303fd84e73({get_latest_notifs_for_existing:!0});
clearInterval(globalIntervalGetPhoneStatus);globalIntervalGetPhoneStatus=setInterval(___getPhoneStatus,24E4);_d5e7f9b029f587c33dba1f3d95770bcd9ae4609c();_ae04b6aded898140e73bf8cc8321830c4c83d8e0(1);_54fbc1791487edd91407cb0c10535139a0064329();_651e16af715f5559f763edd3d750c170197a33b4();_cc613806658c8706872563b2def207ba5f0c8d45();_2141cb4f7addeab8d6aa75efaa34153baa9ffdcb(a);_177940a609be80b3aeddbf9dbec31c1ffd7d7bee({details:a})}
function _177940a609be80b3aeddbf9dbec31c1ffd7d7bee(a){a=a.details;a.hasOwnProperty("current_app_version")&&(window.localStorage.current_phone_app_version=a.current_app_version);window.localStorage.is_pro=isAProUser}
function _54fbc1791487edd91407cb0c10535139a0064329(a){"undefined"===typeof a&&(a=0);_439fc287471807456f79b1fd2d9ee4f7a7e1e6fc("trying to call getThreads! Try count: "+a);$.ajax({url:baseUrl+"/api?function=GetDistinctMessageHeaders&CLIENT=CRX",type:"GET",timeout:9E3,dataType:"json",error:function(b,c,d){1>a?(a++,_54fbc1791487edd91407cb0c10535139a0064329(a)):_7ee8faf91222b20baef9f27cba869bdfc1b144db(_f461f90b0516973d0c1ff8c7ef5410cdb056bf4e)},success:function(a,c,d){$.each(a.messages,function(a,b){0==
b.phone_num_clean&&(b.phone_num="Unknown / Misc");var c;c=$.jStorage.get(username_prefix_jstrg_purpose+"|PC_"+b.phone_num_clean,"no-jstorage-val-found");"no-jstorage-val-found"==c?(c=_305fa7e429b59a8f0838265696be816ed4df610c(b.phone_num_clean),console.log("NO LOCAL JSTORAGE CONTACT NAME MATCH FOR PHONE_NUM_CLEAN: "+b.phone_num_clean+" ... now check array loaded from cloud")):console.log("MATCHED! LOCAL JSTORAGE CONTACT NAME MATCH FOR PHONE_NUM_CLEAN: "+b.phone_num_clean);void 0==c?_439fc287471807456f79b1fd2d9ee4f7a7e1e6fc("contactobj is undefined.  phone num clean: "+
b.phone_num_clean,"red"):(c=$.jStorage.get(username_prefix_jstrg_purpose+"|PH_PIC_"+b.phone_num_clean,"no-jstorage-val-found"),"no-jstorage-val-found"==c?(setTimeout(function(){_ef432847dd3dbfd96fd64d718981bcd960470e92(b.phone_num,b.phone_num_clean)},500*a),console.log("NO CONTACT PHOTO LOCAL JSTORAGE MATCH FOR PHONE_NUM_CLEAN: "+b.phone_num_clean)):console.log("CONTACT PHOTO MATCH LOCAL JSTORAGE MATCH FOR PHONE_NUM_CLEAN: "+b.phone_num_clean))})}})}
function _c56a6b000b49be84b500e3c873ab86e4c87e5859(){if(1>globalPHONEContactsRefreshCacheQueue.length)return!1;var a=globalPHONEContactsRefreshCacheQueue.shift(),b=a[1];$("#thumbnail-if-known-"+a[0]).attr("src",b);0<globalPHONEContactsRefreshCacheQueue.length&&setTimeout(asyncLoopThroughLocalStoragePHONEThumbnailsAndDisplay,100)}
function _ef432847dd3dbfd96fd64d718981bcd960470e92(a,b,c){$.ajax({url:baseUrl+"/phonecontact?function=getPhoneContactPhotos&phone_num_clean="+b+"&phone_num_full="+a,type:"GET",dataType:"json",success:function(a,c,g){0<a.phone_contact_photo_status.length&&(c=a.phone_contact_photo_status,a="0"==a.phone_contact_photo_status?2:"NO_PHOTO"==c?7:30,_439fc287471807456f79b1fd2d9ee4f7a7e1e6fc("Thumbnail returned for: "+b+", at "+new Date+"storing it for: "+a+" days. ","red"),$.jStorage.set(username_prefix_jstrg_purpose+
"|PH_PIC_"+b,{contactThumbnailBinary:c},{TTL:864E5*a}))}})}function _a8ce297065d58be169132a83ee0abe3c86206ca1(a){$.ajax({url:baseUrl+"/phonecontact?function=getPhoneContacts",type:"GET",dataType:"json",success:function(b,c,d){_fb8f75bfbea1eb3df8dc478d332455a8debd5130(b);a&&a()}})}
function _fb8f75bfbea1eb3df8dc478d332455a8debd5130(a){if(0==a.contacts_status)return _439fc287471807456f79b1fd2d9ee4f7a7e1e6fc("No Phone contacts in cloud for this user","red"),!1;$.each(a,function(a,c){var d="";c.hasOwnProperty("contactId");c.hasOwnProperty("displayName")&&(d=c.displayName);c.hasOwnProperty("phoneList")&&$.each(c.phoneList,function(a,b){var c="",f="";b.hasOwnProperty("type")&&(c=b.type);b.hasOwnProperty("phoneNumber")&&(f=b.phoneNumber);cleanPhoneNum=_c946a43efaeeff1db0cbd3d34b30541e024cff09(f);
contactsFromPhoneGlobal.push({phoneNum:f,phoneNumType:c,phoneNumClean:cleanPhoneNum,contactName:d})})})}
function _7ee8faf91222b20baef9f27cba869bdfc1b144db(a,b){$.ajax({type:"GET",url:"https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js",cache:!1,dataType:"text",timeout:8E3,success:function(b,d,e){_439fc287471807456f79b1fd2d9ee4f7a7e1e6fc("CheckRegularInternetConnection succeeded!","#74AAD8","14px");a&&a()},error:function(){b&&b();_439fc287471807456f79b1fd2d9ee4f7a7e1e6fc("Error:  Unable to fetch "+this.url+", so there must be an issue with the user's internet connectivity","#74AAD8","14px")}})}
function _a0419897fdd53067666b8229e0b075f897d959ca(a,b,c,d){var e=baseUrl+"/client";b="function=send&deviceType=ac2dm&source_client=31&action="+a+"&action_data="+b;c&&(b+="&extra_param"+c);console.log("send url for Custom C2DM is: "+e);console.log("post vars string: "+b);$.ajax({url:e,type:"POST",data:b,dataType:"text",timeout:8E3,success:function(b,e,f){time_last_success_mighty_ping=new Date;-1<b.search("sent to phone")?"fetch_binary_from_url_store_on_device"==a||"launch_from_url"==a||"send_snippet_to_phone"==
a?_2741e107cd109c21e5e04a53a8e4939ed59e418f(d,!0):"push_phone_contacts_to_cloud"==a&&c&&"user-clicked-clear-contacts-button-so-flush-jstorage"==c&&_67b83a33c7911fda84be093139f9a4d2ad14b99a(!0):("fetch_binary_from_url_store_on_device"==a||"launch_from_url"==a||"send_snippet_to_phone"==a?_2741e107cd109c21e5e04a53a8e4939ed59e418f(d,!1):"push_phone_contacts_to_cloud"==a&&c&&"user-clicked-clear-contacts-button-so-flush-jstorage"==c&&_67b83a33c7911fda84be093139f9a4d2ad14b99a(!1),_33611a95b5d363584333d94b3f4e8f2090012a8e(a,
b))},error:function(b,e,f){"fetch_binary_from_url_store_on_device"==a||"launch_from_url"==a||"send_snippet_to_phone"==a?_2741e107cd109c21e5e04a53a8e4939ed59e418f(d,!1):"push_phone_contacts_to_cloud"==a&&c&&"user-clicked-clear-contacts-button-so-flush-jstorage"==c&&_67b83a33c7911fda84be093139f9a4d2ad14b99a(!1);console.log("Error in C2DM: "+f);console.log("Error details: "+f.error)}})}
function _2362347a367eb9b12584d58bc636ba8929137513(a){var b=manifest.version,c=[];c["10.2"]=[];c["10.2"].headline="New! Instantly send pictures from your computer to your phone";c["10.2"].body="\r\nJust right-click on an image on any web page and select 'Send Image to your Phone' and you will see it on your phone instantly.\r\n ";c["12.4"]=[];c["12.4"].headline="New! Text web pages & photos directly from Chrome";c["12.4"].body="Click to learn more.";c["12.5"]=[];c["12.5"].headline="New! Send (almost) anything to your phone";
c["12.5"].body="Instantly send web pages, maps, text snippets, and more...\n\nClick here for details.";c["13.0"]=[];c["13.0"].headline="New Extension Options!";c["13.0"].body="Set preferences for Notifications of incoming messages, phone apps, and more...";c["13.0"].extended_content="Click here to try!";c["15.0"]=[];c["15.0"].headline="New in MightyText Chrome Extension";c["15.0"].body="Notification Sounds, Quick Notification Toggle, New Settings options.";c["15.0"].extended_content="Click to learn more...";
c["15.1"]=[];c["15.1"].headline="Testing";c["15.1"].body="Testing123";var d=(new Date(a.ts_creation)).getTime(),e=((new Date).getTime()-d)/864E5;console.log({userTSCreation:a.ts_creation,tsCreationMilli:d,mtAgeInDays:e});c[b]&&1<e?"1"==$.jStorage.get("news_"+b,"no-news-shown-yet")?console.log("news for this version has already been seen"):(a={type:"basic",title:c[b].headline,message:c[b].body,iconUrl:"../img/48x48_MT_logo_boom_gradient_white.png",priority:2},void 0!=c[b].extended_content&&(a.contextMessage=
c[b].extended_content),chrome.notifications.create("news_notif_"+b,a,function(a){$.jStorage.set("news_"+b,"1");console.log("notif with id: "+a+" created.");_gaq.push(["_trackEvent","CRX",a,"Impression"])})):console.log("no news found for this version.")}
function _7f994d2d698f4d48e48b760f7dc4815663234040(a){var b={},c={},d={};"no-internet"==a||"default-icon-on-background-start"==a?(chrome.contextMenus.removeAll(function(){console.log("user is not logged in/there is no internet connectivity, so we should remove all context menus")}),b.path={19:"../img/19x19MT_logo_no_int_conn.png",38:"../img/38x38MT_logo_no_int_conn.png"},d.title="MightyText\n"+chrome.i18n.getMessage("browser_action_no_int"),c.popup="../html/generic.html"):"user-not-logged-in"==a?
(chrome.contextMenus.removeAll(function(){console.log("user is not logged in/there is no internet connectivity, so we should remove all context menus")}),b.path={19:"../img/19x19-mt-signed-out.png",38:"../img/38x38-mt-signed-out.png"},d.title="MightyText\n"+chrome.i18n.getMessage("browser_action_no_cookie"),chrome.browserAction.onClicked.removeListener(_0d334d53f31eb4e9231e7bb5209b11e3931c34b9),chrome.browserAction.onClicked.addListener(_0d334d53f31eb4e9231e7bb5209b11e3931c34b9),c.popup=""):"user-logged-in"==
a?(c.popup="../html/popup.html",window.localStorage.global_notifications&&"0"==window.localStorage.global_notifications?(b.path={19:"../img/19x19-mt-notif-off.png",38:"../img/38x38-mt-notif-off.png"},d.title="MightyText\n"+chrome.i18n.getMessage("browser_action_global_notifs_off")):window.localStorage.message_notifications&&"0"==window.localStorage.message_notifications?(b.path={19:"../img/19x19-mt-notif-off.png",38:"../img/38x38-mt-notif-off.png"},d.title="MightyText\n"+chrome.i18n.getMessage("browser_action_msg_notifs_off")):
(b.path={19:"../img/19x19_MT_logo_boom_gradient_white.png",38:"../img/38x38_MT_logo_boom_gradient_white.png"},d.title="MightyText\n"+chrome.i18n.getMessage("browser_action_logged_in"))):"cannot-connect-to-textyserver"==a&&(chrome.contextMenus.removeAll(function(){console.log("user is not logged in/there is no internet connectivity, so we should remove all context menus")}),c.popup="../html/generic.html",b.path={19:"../img/19x19_cant_reach_mt.png",38:"../img/38x38_cant_reach_mt.png"},d.title="MightyText\n"+
chrome.i18n.getMessage("browser_action_unable_to_connect"));chrome.browserAction.setPopup(c);chrome.browserAction.setTitle(d);chrome.browserAction.setIcon(b)}
function _9c919ed7c3296451894bd5cfb3ed464be379768c(){chrome.tabs.query({currentWindow:!0,url:"https://mightytext.net/*"},function(a){0<a.length?$(a).each(function(b,c){var d=c.url;console.log(c);if(-1<d.indexOf("mightytext.net/web")||-1<d.indexOf("mightytext.net/app"))return chrome.tabs.update(c.id,{active:!0},function(){console.log("User focused in MT App")}),!1;b+1==a.length&&chrome.tabs.create({active:!0,url:"https://mightytext.net/"+currentProductionPath},function(){console.log("new tab of MightyText WebApp created.")})}):
chrome.tabs.create({active:!0,url:"https://mightytext.net/"+currentProductionPath},function(){console.log("new tab of MightyText WebApp created.")})})}
function _f9384be676e5fe8e6249d6c2432ceb2718a3a09d(a){$.ajax({url:baseUrl+"/api?function=getUserInfoFull&CLIENT=CRX",type:"GET",timeout:1E4,dataType:"json",error:function(a,c,d){console.log("ERROR in AJAX in getUserInfoFull: "+d)},success:function(b,c,d){console.log(b);b.user_info_full&&0<b.user_info_full.email.length?a?_75a3f6791f531f3f04a44f2332e1760564962648("User-Signed-In-From-Another-Client"):_7f994d2d698f4d48e48b760f7dc4815663234040("user-logged-in"):"user not logged in"==b.user&&_75a3f6791f531f3f04a44f2332e1760564962648("User-Signed-Out-From-Another-Client")}})}
chrome.runtime.onMessage.addListener(function(a,b,c){a.new_notify_background_that_user_is_logged_in?(_75a3f6791f531f3f04a44f2332e1760564962648("User-Signed-In-From-CRX"),c({reply:"successful_user_login"})):a.notify_crx_from_webapp_signin?(_f9384be676e5fe8e6249d6c2432ceb2718a3a09d(!0),c({reply:"notify_crx_from_webapp_signin"})):a.setProperBrowserActionIcon?(_7f994d2d698f4d48e48b760f7dc4815663234040("user-logged-in"),c({reply:"setting_browser_action_icon"})):a.reloadCRX?(_75a3f6791f531f3f04a44f2332e1760564962648(a.reloadReason),
c({reply:"reloading_crx_now"})):a.userClickedClearContactsButton?(_a0419897fdd53067666b8229e0b075f897d959ca("push_phone_contacts_to_cloud","na","user-clicked-clear-contacts-button-so-flush-jstorage"),c({reply:"request_made_phone"})):a.handle_gcm_error?(a.hasOwnProperty("details")&&a.details.hasOwnProperty("action")&&a.details.hasOwnProperty("server_resp")?(b={received_request_to_handle_gcm_error:!0},_33611a95b5d363584333d94b3f4e8f2090012a8e(a.details.action,a.details.server_resp)):(console.error(a),
b={error_with_message_to_handle_gcm_errors:!0}),c(b)):a.hasOwnProperty("get_username_prefix")?c({username_prefix:username_prefix_jstrg_purpose}):a.hasOwnProperty("user_loaded_phone_notif_live_view")&&_06f32bc5dd116a8e986400d130cbff01951baa55()});
function _06f32bc5dd116a8e986400d130cbff01951baa55(){setTimeout(function(){if("undefined"!=typeof global_time_last_CAPI_rcvd){var a=new Date,b=(a-global_time_last_CAPI_rcvd)/1E3,c="false",d={ts_last_capi_rcvd_lt_30_secs_ago:!1};30>b&&(c="true",d.ts_last_capi_rcvd_lt_30_secs_ago=!0);console.info("checking when the last time a user received a CAPI to determine if they have a healthy CAPI socket",{now:a,ts_last_capi_rcvd:global_time_last_CAPI_rcvd,time_diff:b});console.info("last capi rcvd analytics event details",
{action:"pnlv-triggered-ts-since-last-capi-rcvd",label:c,properties:d});_gaq.push(["_trackEvent","CRX","pnlv-triggered-ts-since-last-capi-rcvd",c]);_kmq.push(["record","pnlv-triggered-ts-since-last-capi-rcvd",d])}},5E3)}
function _33611a95b5d363584333d94b3f4e8f2090012a8e(a,b){var c;-1<b.indexOf("LOGIN_REQUIRED")?(_gaq.push(["_trackEvent","CRX","C2DM-Error","LOGIN_REQUIRED",1]),chrome.i18n.getMessage("error_not_logged_in"),_7f994d2d698f4d48e48b760f7dc4815663234040("user-not-logged-in"),_7090fdea2e3abbf2c7d2451d174f3d9835681edf()):(-1<b.indexOf("DEVICE_NOT_REGISTERED")?(_gaq.push(["_trackEvent","CRX","C2DM-Error","DEVICE_NOT_REG",1]),c=chrome.i18n.getMessage("error_not_registered")):-1<b.indexOf("DeviceQuotaExceeded")?
(_gaq.push(["_trackEvent","CRX","C2DM-Error","DEVICE_QUOTA_EXCEEDED",1]),c=chrome.i18n.getMessage("error_phone_quota_exceeded")):(_gaq.push(["_trackEvent","CRX","C2DM-Error","GENERAL C2DM ERROR",1]),c=chrome.i18n.getMessage("gen_c2dm_error")+b),alert(c))}
function _211d6cbf06e929bc9ed8388ee5588d8ba0dceda0(){var a=NEW_COUNT_GLOBAL_NOTIF;10<NEW_COUNT_GLOBAL_NOTIF&&(a="10plus");_gaq.push(["_trackEvent","CRX-Background","Error","getUserInfo-CRX-GU72-"+a,1]);console.log("----------------");NEW_COUNT_GLOBAL_NOTIF++;2>NEW_COUNT_GLOBAL_NOTIF&&(a={type:"basic",priority:2,title:chrome.i18n.getMessage("mt_connection_issue_notif_title"),message:chrome.i18n.getMessage("mt_connection_issue_notif_content"),iconUrl:"../img/notifications/error_icon.png"},chrome.notifications.create("connection-error-GU72",
a,function(a){console.log('just created a notif with the ID: "'+a+'"');_a0b818d8a313f49406787ab60651b5d5970bed28(a);_501841532e653ca08fe8590565cf915540b3a799(a,2E4)}));_7f994d2d698f4d48e48b760f7dc4815663234040("cannot-connect-to-textyserver")}
function _f461f90b0516973d0c1ff8c7ef5410cdb056bf4e(){_gaq.push(["_trackEvent","CRX-Background","Error","getDistinctHeaders-CRX-GTHRD59",1]);if(1>NEW_COUNT_GLOBAL_NOTIF){var a={type:"basic",priority:2,title:chrome.i18n.getMessage("mt_sys_issues_notif_title"),message:chrome.i18n.getMessage("mt_sys_issues_notif_content"),iconUrl:"error_icon.png"};chrome.notifications.create("distinct-header-error-GTHRD59",a,function(a){console.log('just created a notif with the ID: "'+a+'"');_a0b818d8a313f49406787ab60651b5d5970bed28(a);
_501841532e653ca08fe8590565cf915540b3a799(a,1E4)})}}function ___getPhoneStatus(){global_count_request_phone_status++;1E3>global_count_request_phone_status?_a0419897fdd53067666b8229e0b075f897d959ca("get_phone_status","check-phone-status-not-needed"):alert(chrome.i18n.getMessage("phone_status_interval_error"))}
function _cc613806658c8706872563b2def207ba5f0c8d45(){var a=window.localStorage,b=!1;void 0===a.notif_battery_fully_charged&&(a.notif_battery_fully_charged=1);void 0===a.notif_battery_low&&(a.notif_battery_low=1);void 0===a.global_notifications&&(a.global_notifications=1);void 0===a.message_notifications&&(a.message_notifications=1,b=!0);void 0===a.phone_app_notifications&&(a.phone_app_notifications=1);void 0===a.notif_content&&(a.notif_content=1,b=!0);void 0===a.notif_auto_dismiss&&(a.notif_auto_dismiss=
0,b=!0);void 0===a.notif_auto_dismiss_time&&(a.notif_auto_dismiss_time=10,b=!0);void 0===a.notif_sound_mode&&(a.notif_sound_mode=0);void 0===a.notif_sound_tone&&(a.notif_sound_tone="Proxima.ogg");b&&setTimeout(function(){"function"==typeof ___getUserLegacyServerSettings?___getUserLegacyServerSettings():_439fc287471807456f79b1fd2d9ee4f7a7e1e6fc("___getUserLegacyServerSettings is not defined!!","red")},5E3)}
function _b54a3300bcc2d8bf643802f90d142f2856ec3afc(){var a=document.body.appendChild(document.createElement("iframe"));a.src="https://mightytext.net/prod-assets/chrome_ext_heartbeat";a.height=0;a.onload=function(){console.log("set localstorage of CRX alive via iframe")}}
function _75a3f6791f531f3f04a44f2332e1760564962648(a){a||(a="Unknown");10>Math.floor(100*Math.random())&&_gaq.push(["_trackEvent","CRX-Background","CRX-Forced-Reload-Sample-10pct",a]);setTimeout(function(){window.location.reload()},1E3)}function _0d334d53f31eb4e9231e7bb5209b11e3931c34b9(){chrome.tabs.create({url:signInUrlCRX},function(){console.log("new tab of signInURL created")})}function _d5e7f9b029f587c33dba1f3d95770bcd9ae4609c(){return!1}
function _ba46600e03bc97e6ebf07b304d91a5e7d4b109b9(){chrome.browserAction.getTitle({},function(a){_439fc287471807456f79b1fd2d9ee4f7a7e1e6fc("Inside of _ba46600e03bc97e6ebf07b304d91a5e7d4b109b9. Current BA tooltip content: "+a,"#FF8DC6","14px");if(-1<a.indexOf("Please check your internet connection"))if(_439fc287471807456f79b1fd2d9ee4f7a7e1e6fc("BA indicates user has no internet connectivity.  Confirming...","#FF8DC6","14px"),navigator.onLine)_7ee8faf91222b20baef9f27cba869bdfc1b144db(function(){_75a3f6791f531f3f04a44f2332e1760564962648("Browser-Action-Incorrect-No-Int")});
else return!1;else-1<a.indexOf("Not Logged In")&&(_439fc287471807456f79b1fd2d9ee4f7a7e1e6fc("BA indicates user is not signed into MT.  Confirming that they have internet connectivity.","#FF8DC6","14px"),navigator.onLine?_7ee8faf91222b20baef9f27cba869bdfc1b144db("",function(){_75a3f6791f531f3f04a44f2332e1760564962648("Browser-Action-Incorrect-Not-Logged-In")}):_75a3f6791f531f3f04a44f2332e1760564962648("Browser-Action-Not-Logged-In-Wrong"))})}
function _ae04b6aded898140e73bf8cc8321830c4c83d8e0(a){"undefined"!==typeof goog&&_gaq.push(["_trackEvent","CRX-Background","Channel-JS-Lib-Load-Dup",""]);_439fc287471807456f79b1fd2d9ee4f7a7e1e6fc("Trying to get channel.js from Google. This is attempt #"+a,"blue");$.ajax({url:"https://talkgadget.google.com/talkgadget/channel.js",dataType:"script",timeout:3E3,success:function(b){_439fc287471807456f79b1fd2d9ee4f7a7e1e6fc("Successfully loaded channel.js from Google via ajax. This is attempt #"+a,"green");
_e2b2d8e928dd8c964f76923982d10b7b9686506e()},error:function(b,c,d){_439fc287471807456f79b1fd2d9ee4f7a7e1e6fc("Error getting channel.js from Google.  ErrorThrown: "+d+"This is attempt #"+a,"red");3>a?setTimeout(function(){a++;_ae04b6aded898140e73bf8cc8321830c4c83d8e0(a)},1E3):(_gaq.push(["_trackEvent","CRX-Background","Channel-JS-Lib-Load-Error",c]),_febb6c6040887d157cd695954bfb71fab2118579())}})}
function ___getUserLegacyServerSettings(a){$.ajax({url:baseUrl+"/usersettings?function=getUserSettings",type:"POST",dataType:"json",success:function(b){void 0!=b.usersettings.settings_list&&(b=jQuery.parseJSON(b.usersettings.settings_list.value),"undefined"!=typeof a&&a.hasOwnProperty("reminders_exp_flag_key")?(a.user_settings=b,_60fafcb717bf345e2f9a2030d820433b0bbf2d4c(a)):_5a4aed4f3a3cc0c787ab5ab13f509e27bcf22f90(b))}})}
function _5a4aed4f3a3cc0c787ab5ab13f509e27bcf22f90(a){var b=a.notif_toggle_on_off,c=a.notif_content;a=a.notif_dismiss_time;var d=window.localStorage;console.log({toggle:b,privacy:c,dismiss:a});b&&"0"==b&&(d.message_notifications=0);c&&"1"==c&&(d.notif_content=0);a&&"9999"!=a&&60>parseInt(a)&&(d.notif_auto_dismiss=1,"30"==a&&(a="20"),d.notif_auto_dismiss_time=a)}
function _85945a3e4c69171c703685f7b1e1fe4cc0986b60(a){a&&___clearJstorage(!0);_1322958b09686e7c690840bc7de375bf72537dfb();_a8ce297065d58be169132a83ee0abe3c86206ca1();setTimeout(function(){_54fbc1791487edd91407cb0c10535139a0064329()},2E3)}function _67b83a33c7911fda84be093139f9a4d2ad14b99a(a){chrome.runtime.sendMessage({refreshContactsFromPhoneC2DMSent:!0,status:a},function(a){console.log(a)})}
function _9fcea60249e16ef6e8feae3718db66659eab5e25(a){$(contactsFromPhoneGlobal).each(function(a,c){var d=username_prefix_jstrg_purpose+"|PC_"+c.phoneNumClean;"contact-not-found-in-jstorage"!=$.jStorage.get(d,"contact-not-found-in-jstorage")&&$.jStorage.deleteKey(d)});a&&a()}function _1322958b09686e7c690840bc7de375bf72537dfb(){contactsFromPhoneGlobal=[]}
function _238a7800e61d7eeb8384cbdf2ef339be8a652455(){_a8ce297065d58be169132a83ee0abe3c86206ca1(function(){_54fbc1791487edd91407cb0c10535139a0064329()})}function _1255cdf45e14e300b68bbf2484c0ff9732fa464d(){chrome.idle.queryState(globalSystemIdleStatusThresholdInSeconds,function(a){_439fc287471807456f79b1fd2d9ee4f7a7e1e6fc('Setting var globalLastKnownSystemStatus to: "'+a+'"',"purple");globalLastKnownSystemStatus=a})}chrome.idle.setDetectionInterval(globalSystemIdleStatusThresholdInSeconds);
chrome.idle.onStateChanged.addListener(function(a){"active"==a&&"locked"==globalLastKnownSystemStatus&&(_6b949d6799f3b4ce228c7e5022ab6a379f3d16ef(),_439fc287471807456f79b1fd2d9ee4f7a7e1e6fc("the system was locked, but became active","orange"));globalLastKnownSystemStatus=a;_439fc287471807456f79b1fd2d9ee4f7a7e1e6fc("System status changed to: "+a+" at: "+new Date,"orange")});
function _2141cb4f7addeab8d6aa75efaa34153baa9ffdcb(a){"exp-flag-not-set"==$.jStorage.get("mt_reminders_experiment","exp-flag-not-set")&&___getUserLegacyServerSettings({reminders_exp_flag_key:"mt_reminders_experiment",user_info:a})}
function _60fafcb717bf345e2f9a2030d820433b0bbf2d4c(a){var b=a.user_info,c=a.user_settings,d=a.reminders_exp_flag_key;chrome.runtime.getPlatformInfo(function(a){var g="unknown";"mac"==a.os?g="Mac":"win"==a.os&&(g="Windows");chrome.tabs.query({active:!0,currentWindow:!0},function(a){0<a.length&&(a=a[0].height,a={phone_apk_version:parseFloat(b.current_app_version),os:g,browser:"Chrome",viewport_height:a,is_pro:isAProUser,phone_lang:c.language,crx_version:manifest.version,client:"crx"},a=JSON.stringify(a),
$.ajax({type:"POST",url:baseUrl+"/bridge?function=checkIfUserIsInRemindersExp",data:{client_details:a},dataType:"json",success:function(a){console.info(a);a.hasOwnProperty("status")&&"true"==a.status&&$.jStorage.set(d,"user-in-exp")},error:function(a,b,c){console.error(new Date+" an error occurred while checking user's reminder exp status: "+b)}}))})})};