var app,cfg,Tabs,Port;try{window._sessionStorage=sessionStorage}catch(ex){window._sessionStorage={}}if(location.hash){app=location.hash.slice(1).split(",");app={name:app[0],version:app[1]}}if(this.browser&&this.browser.extension)this.chrome=this.browser;app=chrome.runtime.getManifest();app={name:app.name,version:app.version};cfg=localStorage;Tabs={};Tabs.create=function(params){chrome.windows.getCurrent(function(win){delete params.incognito;params.windowId=win.id;chrome.tabs.create(params)})};
Tabs.getSelected=function(cb){chrome.tabs.query({"active":true,"currentWindow":true},function(tabs){cb(tabs[0])})};
Port={parse_msg:function(msg,origin,postMessage){return{msg:msg,origin:origin.url,postMessage:postMessage}},listen:function(fn){chrome.runtime.onMessage.addListener(fn)},broadcast:function(){chrome.tabs.query({},function(tabs){var i=tabs.length,rgxURLIgnore=/^chrome[:-]/,sender=function(msg){(chrome.tabs.sendMessage||chrome.tabs.sendRequest)(tabs[i].id,msg)};while(i--)if(!rgxURLIgnore.test(tabs[i].url))onMessage({"cmd":"hello"},{"tab":tabs[i]},sender)})}};
var copyToClipboard=function(data){document.oncopy=function(ev){document.oncopy=null;ev.clipboardData.setData("text/plain",data);ev.preventDefault()};document.execCommand("copy")};var to_fromHistory=chrome.history&&function(url,remove_if_visited){if(remove_if_visited)chrome.history.getVisits({"url":url},function(visits){chrome.history[(visits.length?"delete":"add")+"Url"]({"url":url})});else chrome.history.addUrl({"url":url})};
